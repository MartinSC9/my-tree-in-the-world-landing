# Sistema de EcoPoints y Rankings

## ¬øQu√© son los EcoPoints?

Los **EcoPoints** son un sistema de puntuaci√≥n que reconoce tu impacto ambiental en la plataforma. Sirven para:

- üèÜ Aparecer en el **Ranking de Top Plantadores**
- üìä Medir tu contribuci√≥n al medio ambiente
- üéñÔ∏è Desbloquear insignias y niveles
- üåç Compararte con otros usuarios comprometidos con el planeta

---

## ¬øC√≥mo se calculan los EcoPoints?

### Puntos por √Årboles Individuales
- üå≥ **10 EcoPoints** por cada √°rbol individual plantado
- Ejemplo: Si plantas 5 √°rboles individuales = 50 EcoPoints

### Puntos por √Årboles Colaborativos
- ü§ù **5 EcoPoints** por cada aporte a proyecto colaborativo
- Da igual el monto: $100 ARS o $10,000 ARS = 5 EcoPoints
- Raz√≥n: Incentiva participaci√≥n, no solo dinero

### Puntos por Completar Perfil
- ‚úÖ **10 EcoPoints** por completar tu perfil al 100%
- Incluye: Foto de perfil, nombre completo, bio, ubicaci√≥n

### Bonificaciones Especiales
- üéÅ **20 EcoPoints** por crear tu primer proyecto colaborativo
- üå± **50 EcoPoints** por plantar 10 o m√°s √°rboles (bonificaci√≥n √∫nica)
- üèÖ **100 EcoPoints** por plantar 50 o m√°s √°rboles (bonificaci√≥n √∫nica)

---

## Estructura de tu Perfil

Tu perfil muestra un desglose claro de tu actividad:

```
Total de √Årboles: 5
‚îú‚îÄ Individuales: 3
‚îî‚îÄ Colaborativos: 2

Contribuciones: 8
‚îú‚îÄ √Årboles propios: 3
‚îú‚îÄ Proyectos creados: 1
‚îî‚îÄ Aportes a proyectos: 4

EcoPoints: 75
‚îú‚îÄ Por √°rboles individuales: 30 (3 √ó 10 puntos)
‚îú‚îÄ Por aportes colaborativos: 20 (4 √ó 5 puntos)
‚îú‚îÄ Por crear proyecto: 20 (1 √ó 20 puntos)
‚îî‚îÄ Por completar perfil: 10
```

### Definiciones

- **√Årboles Individuales**: √Årboles que pagaste 100% t√∫ mismo
- **√Årboles Colaborativos**: √Årboles donde participaste con otros usuarios/empresas
- **Contribuciones**: Acciones totales (plantar + aportar + crear proyectos)

---

## Ranking de Top Plantadores

El ranking se actualiza **cada d√≠a a las 00:00hs** y muestra:

### Top 10 de la Semana
```
ü•á 1. Juan P√©rez - 250 EcoPoints
   üìä 15 √°rboles individuales, 50 aportes colaborativos

ü•à 2. Mar√≠a Gonz√°lez - 180 EcoPoints
   üìä 10 √°rboles individuales, 30 aportes colaborativos

ü•â 3. Carlos L√≥pez - 150 EcoPoints
   üìä 12 √°rboles individuales, 10 aportes colaborativos
```

### Top 10 del Mes
Ranking mensual que se reinicia cada 1¬∫ de mes

### Top 10 de Todos los Tiempos
Ranking hist√≥rico desde tu registro

### Filtros disponibles
- üåç Por provincia/ciudad
- üë• Solo amigos/comunidad
- üè¢ Solo usuarios (excluir empresas)

---

## Insignias y Niveles

Tu nivel sube autom√°ticamente seg√∫n tus EcoPoints:

| Nivel | EcoPoints | Insignia | Beneficio |
|-------|-----------|----------|-----------|
| üå± Explorador Ecol√≥gico | 0-49 | üèÖ Bronce | - |
| üåø Guardi√°n Verde | 50-149 | üèÖ Plata | 5% descuento en √°rboles |
| üå≥ Protector Ambiental | 150-299 | üèÖ Oro | 10% descuento en √°rboles |
| üå≤ H√©roe del Planeta | 300-499 | üèÖ Platino | 15% descuento + prioridad en sorteos |
| üåé Leyenda Ecol√≥gica | 500+ | üèÖ Diamante | 20% descuento + insignia especial + menci√≥n en homepage |

**Nota**: Los descuentos aplican en √°rboles individuales, no en aportes a proyectos colaborativos.

---

## Visibilidad de tu Perfil

Puedes controlar qu√© informaci√≥n es p√∫blica:

### Siempre visible (no editable)
- Nombre de usuario
- Nivel e insignia
- EcoPoints totales
- Total de √°rboles plantados (n√∫mero)

### Opcional (puedes ocultar)
- Ubicaci√≥n de √°rboles en mapa (solo si son p√∫blicos)
- Lista de proyectos colaborativos
- Ranking detallado
- Foto de perfil

### Siempre privado
- Email, tel√©fono
- Direcci√≥n de domicilio
- M√©todos de pago
- Documentos de verificaci√≥n

---

## Preguntas Frecuentes

**¬øLos √°rboles colaborativos cuentan en mi total de √°rboles?**
S√≠, pero se muestran separados. Si plantaste 3 √°rboles individuales y aportaste a 2 proyectos colaborativos, tu perfil mostrar√° "Total de √Årboles: 5 (3 individuales, 2 colaborativos)".

**¬øPor qu√© los aportes colaborativos dan menos puntos?**
Para equilibrar el sistema. Si un √°rbol cuesta $20,000 y 10 personas aportan $2,000 cada una, todas reciben 5 EcoPoints. Esto evita que quien aporta m√°s dinero domine el ranking, premiando la participaci√≥n por igual.

**¬øC√≥mo subo de nivel?**
Autom√°ticamente seg√∫n tus EcoPoints. Planta m√°s √°rboles, aporta a proyectos, crea tu propio proyecto colaborativo y completa tu perfil para ganar puntos.

**¬øLos descuentos son acumulativos?**
S√≠. Si eres "H√©roe del Planeta" (15% descuento) y un √°rbol cuesta $20,000, pagas $17,000.

**¬øPuedo perder EcoPoints?**
No. Los EcoPoints son permanentes y no se descuentan. Una vez ganados, son tuyos para siempre.

**¬øLas empresas compiten en el mismo ranking?**
No. Hay rankings separados:
- **Ranking Usuarios**: Solo usuarios finales
- **Ranking Empresas**: Solo empresas
- **Ranking General**: Todos juntos (opcional ver)

---

## Implementaci√≥n T√©cnica (Para Desarrolladores)

### C√°lculo de EcoPoints

```javascript
// Funci√≥n para calcular EcoPoints totales de un usuario
function calculateUserEcoPoints(user, trees, contributions) {
  let points = 0;

  // √Årboles individuales (10 puntos cada uno)
  const individualTrees = trees.filter(t => t.type === 'individual');
  points += individualTrees.length * 10;

  // Aportes a proyectos colaborativos (5 puntos cada uno)
  const collaborativeContributions = contributions.filter(c => c.type === 'collaborative');
  points += collaborativeContributions.length * 5;

  // Perfil completo (10 puntos)
  if (user.profile_completed) {
    points += 10;
  }

  // Crear primer proyecto (20 puntos)
  const ownedProjects = contributions.filter(c => c.creator_id === user.id);
  if (ownedProjects.length >= 1) {
    points += 20;
  }

  // Bonificaci√≥n por 10+ √°rboles (50 puntos, solo una vez)
  if (individualTrees.length >= 10 && !user.bonus_10_trees_claimed) {
    points += 50;
  }

  // Bonificaci√≥n por 50+ √°rboles (100 puntos, solo una vez)
  if (individualTrees.length >= 50 && !user.bonus_50_trees_claimed) {
    points += 100;
  }

  return points;
}
```

### Estructura de Base de Datos

```sql
-- Tabla de usuarios (agregar campos)
ALTER TABLE users ADD COLUMN eco_points INT DEFAULT 0;
ALTER TABLE users ADD COLUMN level VARCHAR(50) DEFAULT 'Explorador Ecol√≥gico';
ALTER TABLE users ADD COLUMN profile_completed BOOLEAN DEFAULT FALSE;
ALTER TABLE users ADD COLUMN bonus_10_trees_claimed BOOLEAN DEFAULT FALSE;
ALTER TABLE users ADD COLUMN bonus_50_trees_claimed BOOLEAN DEFAULT FALSE;

-- Tabla de rankings (nueva)
CREATE TABLE user_rankings (
  id INT PRIMARY KEY AUTO_INCREMENT,
  user_id INT NOT NULL,
  rank_position INT NOT NULL,
  eco_points INT NOT NULL,
  period_type ENUM('week', 'month', 'all_time') NOT NULL,
  period_start DATE NOT NULL,
  period_end DATE NOT NULL,
  created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
  FOREIGN KEY (user_id) REFERENCES users(id)
);

-- √çndices para optimizar consultas de ranking
CREATE INDEX idx_rankings_period ON user_rankings(period_type, period_start, period_end);
CREATE INDEX idx_rankings_points ON user_rankings(eco_points DESC);
```

### Endpoints de API

```javascript
// GET /api/users/:userId/ecopoints - Obtener desglose de EcoPoints
// GET /api/rankings/week - Top 10 de la semana
// GET /api/rankings/month - Top 10 del mes
// GET /api/rankings/all-time - Top 10 de todos los tiempos
// PUT /api/users/:userId/profile-visibility - Configurar privacidad
```

---

## Roadmap de Funcionalidades Futuras

- [ ] **Retos semanales**: Gana EcoPoints extra completando retos (ej: "Planta 3 √°rboles esta semana")
- [ ] **Badges especiales**: Insignias por logros √∫nicos (ej: "Primer √°rbol en tu ciudad", "Plantaste en 5 provincias")
- [ ] **Seguimiento de amigos**: Ve el ranking de tus amigos
- [ ] **Notificaciones de ranking**: "¬°Subiste al puesto #5 esta semana!"
- [ ] **Marketplace de beneficios**: Canjea EcoPoints por descuentos adicionales o merchandise
